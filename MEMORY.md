# MEMORY.md - 长期记忆

## 重要信息记录

### 家庭基本信息
- **记录时间:** 2026-02-10
- **家庭住址:** 上海市杨浦区
- **家庭成员:**
  1. **汪汪 (汪葆春)** - 丈夫，编程工作
  2. **Helen** - 妻子，法国留学签证工作
  3. **儿子** - 11岁，2026年寒假后读四年级下学期
     - **兴趣爱好:** 做手工、养植物动物、玩电子游戏、画画、编程
     - **特点分析:** 兴趣广泛，兼具动手能力、创造力、自然观察力和逻辑思维

### Helen的个人信息
- **兴趣爱好:** 喜欢唱歌
- **喜欢的歌手:** 张碧晨
- **消费习惯:** 喜欢省钱、薅羊毛
- **工作特点:** 法国留学签证相关工作，工作目录在 `/Users/yangyan/Downloads/同步空间/HelenOA`
- **沟通方式:** Slack频道 `D0ADEJGKGF5`

### 系统设置和偏好
- **时区:** Asia/Shanghai
- **主要沟通语言:** 中文
- **互动风格:** 随和、友好
- **已建立的自动化:**
  1. **迪士尼排队监测** - 东京迪士尼乐园，每小时监测前5大项目 (08:00-20:00)，推送给汪汪和Helen两人
  2. **迪士尼每日汇总报告** - 每日21:00发送多天状况一览报告给汪汪
  3. **迪士尼趋势分析报告** - 每日21:30生成工作日/节假日排队趋势图表和建议
  4. **新闻摘要** - 每日08:00自动搜集日本、IT、投资新闻
  5. **Slack连接保持** - 每30分钟检查连接
  6. **张碧晨动态监控** - 每日10:00搜索Helen喜欢的歌手最新动态
  7. **上海优惠信息推送** - 每日15:00搜索本地优惠和省钱机会

### 重要日期和事件
- **2026-02-10:** 用户分享了详细的家庭信息
- **2026-02-10:** 迪士尼排队监测系统设置完成 (监测时段: 08:00-20:00)
- **2026-02-10:** Claude模型测试完成 (Anthropic Claude 3.5 Sonnet)
- **2026-02-10:** 生活助手计划批准实施 (张碧晨动态监控 + 上海优惠信息推送)
- **2026-02-11:** Claude Code开发规则确立 - 开发工具或脚本时优先使用Claude Code
- **2026-02-11:** A股量化分析技能安装 - 安装china-stock-analysis技能并成功使用baostock数据源解决akshare依赖问题
- **2026-02-11:** 搜索API配置完成 - 配置Tavily API并验证搜索功能，解决张碧晨监控、上海优惠信息、新闻推送的搜索需求
- **2026-02-11:** GitHub推送问题解决 - 诊断HTTPS连接问题，切换为SSH协议，确保迪士尼报告正常发布到GitHub Pages
- **2026-02-11:** 定时任务优化 - 根据权限限制调整上海优惠信息只推送给汪汪，避免Slack API的missing_scope错误
- **2026-02-12:** TAVILY_API_KEY重新配置并修复新闻推送定时任务 - 解决早上8点新闻推送失败问题
- **2026-02-12:** Slack通信中断问题解决 - 发现并清除外部干扰服务`ai.openclaw.slack-check`，优化Slack连接稳定性
- **2026-02-12:** 系统时间停滞问题解决 - 确认时间服务恢复正常，时钟持续更新，晚上定时任务可正常执行
- **2026-02-12:** mDNS错误诊断与Gateway重启 - 解决"ERR_SERVER_CLOSED: Cannot send packets on a closed mdns server!"错误，通过终止冲突进程(PID 93255)和启动新实例(PID 138876)恢复稳定
- **2026-02-12:** 细分行业ETF分析成功扩展 - 修复ETF分析脚本，新增54个ETF覆盖传媒娱乐、科技、医药医疗、周期资源、军工等细分领域，提供分类行业分析
- **2026-02-12:** 迪士尼趋势分析报告自动化完成 - 21:30定时任务自动执行成功，生成综合趋势图表和游玩建议，系统稳定性验证完成

### 用户偏好和需求
- **工作方面:** 编程相关任务、自动化设置、技术问题解决
- **生活方面:** 家庭事务、旅行规划、生活助手
- **娱乐方面:** 迪士尼相关信息 (东京迪士尼乐园)
- **沟通偏好:** 直接、实用、避免过度正式
- **信息推送偏好:**
  1. **张碧晨信息:** 关注大麦平台所有相关信息（票务、演出预告等）
  2. **优惠信息:** 关注美团霸王餐所有优惠和杨浦公众号社区活动
  3. **信息格式:** 简洁摘要，只推送确认信息，不推送传闻
  4. **推送时机:** 有重要信息时才推送，日常小动态不推送
  5. **信息质量:** 优先选择有实际价值的信息
- **开发工具规则:**
  1. **首选工具:** 开发工具或脚本时，优先使用Claude Code
  2. **适用场景:** 所有Python脚本、命令行工具、自动化脚本、项目工具开发
  3. **工作流程:** 使用Claude Code CLI，遵循coding-agent技能的工作流程
  4. **执行模式:** 简单任务使用`--print`模式，复杂任务使用background+PTY模式
  5. **技术要点:** 必须在git仓库中运行，使用`pty:true`确保终端正常工作
- **投资分析兴趣:**
  1. **A股量化分析:** 用户对A股行业板块技术分析感兴趣，特别是底部突破识别
  2. **细分行业分析:** 关注申万二级细分行业（如881274影视院线），需要全面覆盖所有细分行业
  3. **多维评估:** 需要技术分析+新闻摘要结合，理解突破背后的基本面驱动
  4. **数据源偏好:** 能接受替代方案（如baostock替代akshare）而非过度调试问题依赖
  5. **实用导向:** 重视实际可用的分析工具而非完美的技术方案
  6. **结构化输出:** 需要按突破强度排序的行业分析报告，推荐排名前3的行业

---

## 重要决策和教训

### 系统配置决策
1. **语音识别方案:** 选择Google Speech Recognition满足当前需求，inference.sh语音识别调试暂缓
2. **AI模型选择:** 配置了DeepSeek和Claude模型，可根据任务需求切换
3. **自动化优先级:** 先满足核心需求，复杂方案可逐步优化
4. **数据源替代策略:** 当主要数据源（如akshare）安装失败时，快速寻找替代方案（如baostock）而非过度调试
5. **技能生态系统:** 优先使用现有技能（如china-stock-analysis）而非从头开发，利用社区资源加快交付
6. **数据源兼容性:** A股数据源存在格式兼容性问题（申万代码881xxx vs. baostock的sh.xxxxxx），需要灵活适配方案
7. **Git协议选择:** 当Git HTTPS推送失败时（HTTP2协议错误、连接超时），应切换到SSH协议。SSH协议更稳定，但需要预先配置SSH密钥和GitHub账户关联
8. **搜索API配置:** Tavily API适合AI优化的搜索任务（新闻、娱乐信息、本地优惠），优先使用现有技能的搜索功能而非从头开发
9. **故障排除流程:** 遇到技术问题（如GitHub推送失败）时，采用系统化诊断：1. 重现问题 2. 网络测试 3. 协议切换 4. 验证解决 5. 报告结果。优先尝试替代方案而非过度调试问题根源。
10. **外部干扰服务管理:** 发现并清理由外部LaunchAgent服务`ai.openclaw.slack-check`造成的Slack连接干扰。重要教训：OpenClaw内置的Slack插件已有完善的连接管理和重连机制，外部检查服务反而会造成冲突。应定期检查系统LaunchAgent服务，避免重复功能干扰。
11. **系统时间同步监控:** 发现系统时间停滞（停留在08:44）导致所有定时任务失效。重要教训：1. 定时任务系统依赖准确的系统时间 2. 时间同步问题可能由macOS时间服务临时异常引起 3. 问题通常会自动恢复，但会错过执行窗口 4. 对于关键任务，应有手动执行备用方案。
12. **mDNS竞态条件处理:** Gateway重启时的mDNS错误"ERR_SERVER_CLOSED"是插件停止时的竞态条件。重要教训：1. 一次性异常通常不影响核心功能 2. 端口冲突可能导致不稳定的Gateway状态 3. 彻底解决问题需要终止所有冲突进程并重新启动干净实例 4. 定期监控Gateway进程健康状态
13. **ETF分析数据适应性:** ETF分析因需要60天完整数据而失败。重要教训：1. 分析工具应适应不同数据量的标的 2. 不因数据量不足而完全放弃分析 3. 对缺失数据提供降级分析方案 4. 明确标注分析结果的局限性
14. **细分行业ETF覆盖策略:** 成功扩展细分行业ETF分析。重要经验：1. 先修复基础分析功能，再扩展覆盖范围 2. 建立分类映射体系（传媒娱乐、科技、医药医疗等） 3. 按行业分类统计提供结构化洞察 4. 技术分析+行业分类结合提高分析价值
15. **定时任务验证机制:** 迪士尼趋势分析自动执行成功验证系统稳定性。重要经验：1. 系统时间修复后定时任务能自动恢复 2. 图表生成和报告推送的完整流程已验证 3. 自动化系统具备自我验证能力 4. 关键任务执行成功是系统健康的积极指标

### 用户互动经验
1. **沟通效率:** 用户偏好直接、高效的沟通方式
2. **反馈响应:** 用户对技术方案会提供具体反馈和要求调整
3. **信息分享:** 用户会主动分享家庭和生活信息以提供更好的帮助
4. **工作流程偏好:** 先配置功能，再手动测试验证，发现问题及时反馈
5. **系统稳定性关注:** 对自动化系统的稳定运行有较高期望，发现问题立即询问
6. **信息控制:** 对推送内容和目标有明确偏好，会根据实际需求调整（如优惠信息只推给汪汪）
7. **决策授权:** 信任授权"你来决定"，允许助手根据紧迫性自主决策任务优先级（2026-02-12示例：A股脚本最高 > 迪士尼cron问题 > 其他任务）

---

## 待办事项跟踪

### 长期目标
1. **家庭助手角色:** 探索如何在工作之外为家庭提供有价值的帮助
2. **技能扩展:** 根据用户兴趣逐步添加相关功能
3. **关系建立:** 与汪汪、Helen和儿子建立良好的互动关系

### 近期关注
1. **迪士尼数据积累:** 持续积累中（2026-02-12 08:44最新记录），数据正常
2. **生活助手实施监控:** ✅ **已手动补执行** - 张碧晨动态(10:00)和优惠信息搜索(15:00)已手动执行。Tavily API验证成功，但发现对中文本地化内容覆盖有限。已推送结果给相应目标。
3. **GitHub推送稳定性:** SSH协议推送正常，需监控长期稳定性
4. **调度器状态监控:** ✅ **系统时间问题已解决** - 系统时钟停滞问题（停留在08:44）已在20:55 GMT+8确认解决。时间服务恢复正常，时钟持续更新，后续定时任务（21:00迪士尼汇总、21:30趋势分析）将按计划执行。
5. **Slack连接稳定性:** ✅ **关键问题已解决** - 发现并清除外部干扰服务`ai.openclaw.slack-check`（LaunchAgent）。该服务每10分钟执行强制修复脚本，与OpenClaw内置Slack插件冲突导致Gateway意外重启。已停止并卸载服务，Slack连接应恢复稳定。**✅ 21:06连接检查正常**，Socket Mode运行稳定。
6. **Helen需求响应:** 等待Helen对帮助建议的回复
7. **A股行业监控系统:** ✅ **已手动补执行** - 简化版脚本于21:03手动执行成功。自主开发方案整合了技术分析(baostock) + Tavily新闻搜索 + 综合推荐功能。已推送分析报告给汪汪。
8. **决策授权经验:** 用户信任授权"你来决定"，助手根据紧迫性自主决策任务优先级（A股脚本最高 > 迪士尼cron问题 > 其他任务）
9. **新闻推送配置问题:** web_search工具需要Brave Search API key，而TAVILY_API_KEY已配置但未在新闻推送任务中使用，需统一搜索API配置
10. **系统时间同步紧急:** ✅ **已解决** - 时间停滞问题已确认解决（20:55 GMT+8）。上午错过的任务已按用户指令"手工执行吧"全部手动补执行完成。
11. **mDNS错误调查:** ✅ **已解决** - Gateway mDNS竞态条件错误诊断完成，通过重启干净实例解决。系统运行稳定(PID 138876)。
12. **细分行业ETF分析扩展:** ✅ **已完成** - 成功修复ETF分析脚本，新增54个ETF覆盖多个细分行业。分析结果显示计算机ETF(5.5/10)和传媒ETF(5.2/10)得分较高。
13. **迪士尼自动化验证:** ✅ **已验证** - 21:00汇总报告和21:30趋势分析自动执行成功，图表生成和推送功能完整验证。
14. **Slack连接稳定性:** ✅ **持续稳定** - 外部干扰清除后Socket Mode连接稳定，21:36心跳检查正常，30分钟心跳机制工作正常。
15. **系统健康综合评估:** 📊 **健康运行** - 所有核心问题已解决，定时任务按计划执行，数据积累正常，用户需求满足度良好。

---

*MEMORY.md 创建于 2026-02-10*
*最后更新: 2026-02-12 (21:37 GMT+8)*